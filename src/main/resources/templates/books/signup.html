<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="layout :: head">
    <!--  헤드 공간  -->
</head>
<body>
<!--  상단바 공간  -->
<header th:replace="layout :: nav"></header>

<div class="d-flex align-items-center py-4 bg-body-tertiary main">
    <div class="form-signin w-100 m-auto">
        <form id="bookCreateForm" method="post">
            <h4>Sign up</h4>
            <!-- 주민등록번호 -->
            <div class="mb-3 row">
                <div class="col">
                    <input type="number" id="id1" name="id1" class="form-control" placeholder="주민등록번호"  maxlength="6" oninput="maxLengthCheck(this)">
                </div>
                <div class="col">
                    <input type="password" id="id2"  inputmode="numeric" name="id2" class="form-control input-number-password" maxlength="7" oninput="maxLengthCheck(this)">
                </div>
           </div>
            <!-- 이름 -->
            <div class="mb-3">
                <input type="text" id="name" name="name" class="form-control" placeholder="name">
            </div>
            <!-- 성별 -->
            <div class="mb-3 row">
                <div class="form-check col-6">
                    <input class="form-check-input" type="radio" name="gender" id="female" value="M" >
                    <label class="form-check-label" for="female">
                        남성
                    </label>
                </div>
                <div class="form-check col-6">
                    <input class="form-check-input" type="radio" name="gender" id="male" value="F">
                    <label class="form-check-label" for="male">
                        여성
                    </label>
                </div>
            </div>
            <!-- 전화번호 -->
            <div class="mb-3 row">
                <div class="col">
                    <input type="number" id="phone1" name="phone1" class="form-control" maxlength="3" oninput="maxLengthCheck(this)">
                </div>
                <div class="col">
                    <input type="number" id="phone2" name="phone2" class="form-control" maxlength="4" oninput="maxLengthCheck(this)">
                </div>
                <div class="col">
                    <input type="number" id="phone3" name="phone3" class="form-control" maxlength="4" oninput="maxLengthCheck(this)">
                </div>
            </div>
            <!-- 주소 -->
            <div class="mb-3">
                <input type="text" id="address" name="address" class="form-control" placeholder="Address">
            </div>
        </form>
        <button class="btn btn-danger" style="width:100%" onclick="addMember()">Add</button>
    </div>
</div>

<!-- 목록-->
<div class="b-example-divider"></div>
<!-- footer -->
<div th:replace="layout :: footer"></div>
<script>
    function addMember() {
        let id = $('#id1').val() + $('#id2').val();
        let name = $('#name').val();
        let gender = $(":input:radio[name=gender]:checked").val();
        let phoneNumber = $('#phone1').val() + $('#phone2').val() + $('#phone3').val();
        let address = $('#address').val();

        let data = {
            'id': id,
            'name': name,
            'gender': gender,
            'phoneNumber': phoneNumber,
            'address': address,
        };
        console.log(data);

        $.ajax({
            url: '[[@{/books/signup}]]', // 요기에
            type : 'POST',
            contentType: "application/json",
            data: JSON.stringify(data),
            success: function (response) {
                console.log(response);
                alert('사용자가 추가되었습니다.');
                window.location.href = '[[@{/books}]]';
            },
            error: function (xhr, status) {
              alert(xhr + " : " + status);
            }
        });
    }

      function maxLengthCheck(object){
    if (object.value.length > object.maxLength){
      object.value = object.value.slice(0, object.maxLength);
    }
  }
</script>
<!--common script -->
<th:block th:replace="layout :: scripts"></th:block>
</body>

</html>
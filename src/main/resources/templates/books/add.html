<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="layout :: head">
    <!--  헤드 공간  -->
</head>
<body>
<!--  상단바 공간  -->
<header th:replace="layout :: nav"></header>

<!-- 입력 공간 -->
<div class="d-flex align-items-center py-4 bg-body-tertiary main">
    <div class="form-signin w-100 m-auto">
        <form id="bookCreateForm" class="needs-validation" method="POST" novalidate>
            <div ></div>
            <div class="mb-3">
                <label for="title" class="form-label">Title</label>
                <input type="text" id="title" name="title" class="form-control" required>
            </div>
            <div class="mb-3">
                <label for="author" class="form-label">Author</label>
                <input type="text" id="author" name="author" class="form-control" required>
            </div>
            <div class="mb-3">
                <label for="publisher" class="form-label">Publisher</label>
                <input type="text" id="publisher" name="publisher" class="form-control" required>
            </div>
            <div class="mb-3">
                <label for="language" class="form-label">Language</label>
                <select id="language" name="language" class="form-control" required>
                    <option value="">Choose language...</option>
                    <option value="en">English</option>
                    <option value="fr">French</option>
                    <option value="de">German</option>
                    <option value="es">Spanish</option>
                    <option value="ko">Korean</option>
                    <!-- 추가적으로 원하는 언어를 여기에 추가할 수 있습니다 -->
                </select>
            </div>
        </form>
        <button class="btn btn-danger" style="width:100%" onclick="addBook()">Add</button>
    </div>
</div>

<!-- 목록-->
<div class="b-example-divider"></div>
<!-- footer -->
<div th:replace="layout :: footer"></div>
<script>
    // 도서 추가 요청
    function addBook() {
        // Bootstrap 입력 검사 기능
        var form = document.getElementById('bookCreateForm');
        // 폼 유효성 검사
        if (form.checkValidity() === false) {
            event.preventDefault();
            event.stopPropagation();
        } else { // 유효성 검사를 통과한 경우에만 AJAX 요청을 보냄
            let title = $('#title').val();
            let author = $('#author').val();
            let language = $('#language').val();
            let publisher = $('#publisher').val();

            // ajax 요청
            $.ajax({
                url: '/books/add',
                type: 'POST',
                contentType: "application/json",
                data: JSON.stringify({
                    'title': title,
                    'author': author,
                    'language': language,
                    'publisher': publisher,
                }),
                success: function (response) {
                    alert('도서가 추가되었습니다.');
                    window.location.href = '/books/detail/' + response.id;
                },
                error: function (xhr, status) {
                    alert(xhr + " : " + status);
                }
            });
        }
        // 유효성 검사가 완료된 후 폼에 'was-validated' 클래스를 추가하여 부트스트랩의 시각적 피드백을 활성화
        form.classList.add('was-validated');
    }

    // 폼 제출을 막고 addBook() 함수가 실행되도록 설정
    document.getElementById('bookCreateForm').addEventListener('submit', function(event) {
        event.preventDefault();
        addBook();
    });
</script>
<!--common script -->
<th:block th:replace="layout :: scripts"></th:block>
</body>

</html>